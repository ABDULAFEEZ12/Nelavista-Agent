<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nelavista AGENT Demo</title>
<style>
    :root {
        --primary-color: #1a73e8;
        --background-color: #f4f4f9;
        --text-color: #333;
        --card-bg: #fff;
        --success-color: #4caf50;
        --fail-color: #f44336;
        --warning-color: #ff9800;
    }
    [data-theme="dark"] {
        --background-color: #181818;
        --text-color: #f0f0f0;
        --card-bg: #242424;
    }
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background-color: var(--background-color); color: var(--text-color); margin:0; }
    header { display:flex; justify-content:space-between; align-items:center; padding:15px 20px; background-color: var(--primary-color); color:#fff;}
    header h1 { margin:0; font-size:24px; }
    .theme-toggle { cursor:pointer; background:#fff; color:var(--primary-color); border:none; padding:8px 12px; border-radius:5px; font-weight:bold;}
    .container { max-width: 1000px; margin: 20px auto; padding: 20px;}
    .card { background: var(--card-bg); padding:20px; border-radius:10px; margin-bottom:20px; box-shadow: 0 0 15px rgba(0,0,0,0.1);}
    h2 { color: var(--primary-color); margin-top:0;}
    label { font-weight:bold;}
    input, textarea { width:100%; padding:10px; margin-top:5px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; background-color: var(--background-color); color: var(--text-color);}
    button { background-color: var(--primary-color); color:#fff; border:none; padding:12px 20px; border-radius:5px; cursor:pointer; font-size:16px; margin-right:10px;}
    button:hover { background-color: #1666c1; }
    pre { background: #f0f0f0; padding:10px; border-radius:5px; overflow-x:auto; max-height:300px;}
    .resource-status { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
    .resource { padding:5px 10px; border-radius:5px; color:#fff; font-weight:bold; animation: deployAnimation 0.5s ease forwards;}
    .success { background-color: var(--success-color); }
    .fail { background-color: var(--fail-color); }
    .pending { background-color: var(--warning-color); }
    @keyframes deployAnimation { 0%{transform: translateY(-20px); opacity:0;} 100%{transform: translateY(0); opacity:1;} }

    /* Sidebar */
    .sidebar { position:fixed; top:0; right:-250px; width:250px; height:100%; background: var(--card-bg); box-shadow:-2px 0 5px rgba(0,0,0,0.3); padding:20px; transition:right 0.3s; z-index:100;}
    .sidebar.open { right:0; }
    .sidebar h3 { margin-top:0; color: var(--primary-color);}
    .sidebar-toggle { position:fixed; top:50%; right:0; transform:translateY(-50%); background:var(--primary-color); color:#fff; padding:8px 12px; border-radius:5px 0 0 5px; cursor:pointer; z-index:101; }

    /* Story */
    .story-output { white-space: pre-wrap; font-family: "Courier New", Courier, monospace; background: #e8e8e8; padding:10px; border-radius:5px; max-height:300px; overflow-y:auto; animation:typewriter 1s steps(40) forwards;}
    @keyframes typewriter { from{width:0;} to{width:100%;} }

    /* Interactive Diagram */
    #diagram { width:100%; height:300px; border:1px solid #ccc; margin-top:15px; border-radius:10px; background: #f9f9f9; position:relative; overflow:hidden;}
    .node { position:absolute; width:120px; height:60px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:bold; color:#fff; transition: all 0.3s; }
    .lambda { background: #ff9800; top: 50px; left: 50px; }
    .api { background: #1a73e8; top: 50px; right: 50px; }
    .s3 { background: #4caf50; bottom: 50px; left: calc(50% - 60px); }

    .task-queue { position:absolute; top:-50px; left:50%; transform:translateX(-50%); background: var(--primary-color); color:#fff; padding:5px 10px; border-radius:5px; animation: queueMove 1s linear forwards; }
    @keyframes queueMove { 0%{ top:-50px; opacity:0;} 50%{ top:120px; opacity:1;} 100%{ top:50px; opacity:1;} }

    /* Arrows */
    .arrow { position:absolute; width:2px; background: var(--text-color); animation: drawArrow 0.5s forwards; }
    @keyframes drawArrow { from{height:0;} to{height:100px;} }

    /* Confetti burst */
    .burst { position:absolute; width:10px; height:10px; border-radius:50%; background: var(--success-color); animation: burstAnim 0.6s ease forwards; }
    @keyframes burstAnim { 0%{opacity:1; transform:scale(0);} 50%{transform:scale(1.5);} 100%{opacity:0; transform:scale(0);} }

    @media(max-width:600px){ .container{ padding:10px;} .node {width:80px; height:50px; font-size:12px;} }
</style>
</head>
<body data-theme="light">
<header>
    <h1>Nelavista AGENT Demo</h1>
    <button class="theme-toggle" onclick="toggleTheme()">Toggle Dark Mode</button>
</header>

<div class="sidebar" id="sidebar">
    <h3>Agent Settings</h3>
    <label>Simulation Speed:</label>
    <input type="range" id="speedRange" min="0.1" max="2" step="0.1" value="1">
    <label><input type="checkbox" id="voiceNotify"> Voice Notifications</label>
</div>
<div class="sidebar-toggle" onclick="toggleSidebar()">⚙️ Settings</div>

<div class="container">
    <div class="card">
        <h2>Run a Task</h2>
        <label for="taskInput">Enter Task Description:</label>
        <textarea id="taskInput" rows="3" placeholder="Describe your task..."></textarea>
        <button onclick="runAgent()">Run Agent</button>
        <h3>Task Queue & Resource Status:</h3>
        <div id="diagram">
            <div class="node lambda">Lambda</div>
            <div class="node api">API Gateway</div>
            <div class="node s3">S3 Bucket</div>
        </div>
        <div class="resource-status" id="resourceStatus"></div>
        <h3>Agent Output:</h3>
        <pre id="agentOutput">Nothing yet.</pre>
    </div>

    <div class="card">
        <h2>Generate Story</h2>
        <label for="storyTaskInput">Task:</label>
        <input type="text" id="storyTaskInput" placeholder="Task name">
        <label for="storyInfraInput">Infrastructure (JSON format):</label>
        <textarea id="storyInfraInput" rows="3" placeholder='{"resources":["Lambda Function","API Gateway Endpoint","S3 Bucket"]}'></textarea>
        <label for="storyExecutionInput">Execution (JSON format):</label>
        <textarea id="storyExecutionInput" rows="3" placeholder='{"message":"Deployed 3 resources successfully."}'></textarea>
        <button onclick="generateStory()">Generate Story</button>
        <button onclick="copyHistory()">Copy Full History</button>
        <h3>Story Output:</h3>
        <pre id="storyOutput" class="story-output">Nothing yet.</pre>
    </div>
</div>

<script>
let history = [];

function toggleTheme() {
    document.body.dataset.theme = document.body.dataset.theme === "light" ? "dark" : "light";
}
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

async function runAgent() {
    const task = document.getElementById("taskInput").value;
    const speed = parseFloat(document.getElementById("speedRange").value);
    const voiceNotify = document.getElementById("voiceNotify").checked;
    const resourceDiv = document.getElementById("resourceStatus");
    const diagram = document.getElementById("diagram");
    resourceDiv.innerHTML = "";

    const resources = ["Lambda Function", "API Gateway Endpoint", "S3 Bucket"];
    let executed_resources = [];

    // Animate Task Queue
    const queue = document.createElement("div");
    queue.className = "task-queue";
    queue.textContent = task;
    diagram.appendChild(queue);

    // Draw arrows between nodes
    const lambda = diagram.querySelector(".lambda");
    const api = diagram.querySelector(".api");
    const s3 = diagram.querySelector(".s3");

    function drawArrow(from, to) {
        const arrow = document.createElement("div");
        arrow.className = "arrow";
        arrow.style.left = from.offsetLeft + from.offsetWidth/2 + "px";
        arrow.style.top = from.offsetTop + from.offsetHeight + "px";
        arrow.style.height = (to.offsetTop - from.offsetTop - from.offsetHeight) + "px";
        diagram.appendChild(arrow);
        setTimeout(()=>arrow.remove(), 1000);
    }

    for(let i=0; i<resources.length; i++){
        const res = resources[i];
        const div = document.createElement("div");
        div.textContent = res + " (Pending)";
        div.classList.add("resource","pending");
        resourceDiv.appendChild(div);

        // Animate arrow
        if(i===0) drawArrow(lambda, api);
        if(i===1) drawArrow(api, s3);

        await new Promise(r => setTimeout(r, 500/speed));
        div.textContent = res + " (Success)";
        div.classList.remove("pending"); div.classList.add("success");
        executed_resources.push(res);

        // Burst animation
        const burst = document.createElement("div");
        burst.className = "burst";
        burst.style.left = div.offsetLeft + "px";
        burst.style.top = div.offsetTop + "px";
        resourceDiv.appendChild(burst);
        setTimeout(()=>burst.remove(),600);

        if(voiceNotify) new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg').play();
    }
    diagram.removeChild(queue);

    const output = {
        result: {
            task: task,
            reasoning: `Analyzed task: '${task}' and created an execution plan.`,
            infra_plan: { service: "Lambda + API Gateway", task_summary: task, resources },
            execution: { status: "success", executed_resources, message: `Deployed ${executed_resources.length} resources successfully.` }
        }
    };
    document.getElementById("agentOutput").textContent = JSON.stringify(output, null, 2);

    history.push({ task, infra: {resources}, execution: { message: `Deployed ${executed_resources.length} resources successfully.` } });
    document.getElementById("storyTaskInput").value = task;
    document.getElementById("storyInfraInput").value = JSON.stringify({resources}, null, 2);
    document.getElementById("storyExecutionInput").value = JSON.stringify({ message: `Deployed ${executed_resources.length} resources successfully.` }, null, 2);
}

async function generateStory() {
    const task = document.getElementById("storyTaskInput").value;
    const infra = JSON.parse(document.getElementById("storyInfraInput").value);
    const execution = JSON.parse(document.getElementById("storyExecutionInput").value);

    const story = `The task '${task}' was executed successfully.
Infrastructure used: ${infra.resources.join(", ")}.
Execution summary: ${execution.message}.
Lambda handled logic, API Gateway exposed the endpoint, and S3 provided storage.
This architecture ensures scalability and smooth operations.`;
    document.getElementById("storyOutput").textContent = story;
}

function copyHistory() {
    const text = JSON.stringify(history, null, 2);
    navigator.clipboard.writeText(text).then(()=>alert("History copied to clipboard!"));
}
</script>
</body>
</html>
